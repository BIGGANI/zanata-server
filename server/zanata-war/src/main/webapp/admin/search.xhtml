<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    template="../WEB-INF/layout/template.xhtml">

    <ui:define name="page_title">#{messages['jsf.ManageSearch']}</ui:define>
    <ui:define name="center_content">
      <rich:jQuery selector="#tab_admin" query="addClass('ui-tabs-selected')" />
      <rich:panel>
        <h1>#{messages['jsf.ManageSearch']}</h1>
                 
        <!-- TODO reformat indentation, change button label id to match progress message id -->
        <a4j:form>
          <s:token allowMultiplePosts="true" />
          <a4j:region>
            <a4j:outputPanel id="reindexPanel">

              <!-- minValue is -1 because of a bug when 0 is used -->
              <!-- reRender expression is present as reRenderAfterComplete fails sometimes -->
              <rich:progressBar id="reindexProgressBar"
                    value="#{reindexAction.reindexProgress}"
                    interval="1000"
                    label="#{messages['jsf.search.reindex.ProgressMessage']}"
                    minValue="-1"
                    maxValue="#{reindexAction.reindexCount - 1}"
                    enabled="#{reindexAction.reindexing}"
                    reRender="#{reindexAction.reindexing ? reindex : reindexPanel}"
                    reRenderAfterComplete="reindexPanel">
              </rich:progressBar>

              <h:outputText rendered="#{reindexAction.reindexError}" escape="false">
                <p>#{messages['jsf.search.reindex.ErrorMessage']}</p>
              </h:outputText>
              <h:outputText rendered="#{reindexAction.reindexError}" escape="false">
                <p>#{messages['jsf.search.reindex.PleaseReindex']}</p>
              </h:outputText>

              <rich:dataTable id="classList" rows="#{reindexAction.classes.size}"
                              value="#{reindexAction.classes.toArray()}" var="clazz"
                              rendered="#{!reindexAction.reindexing}"
                              reRender="reindexPanel">
                <rich:column width="270px" sortBy="#{clazz.className}" sortOrder="ASCENDING" selfSorted="false">
                  <f:facet name="header">Class</f:facet>
                  <h:outputText value="#{clazz.className}" />
                </rich:column>
                <rich:column width="auto" styleClass="centered">
                  <f:facet name="header">Purge index</f:facet>
                  <h:selectBooleanCheckbox value="#{clazz.purge}" />
                </rich:column>
                <rich:column width="auto" styleClass="centered">
                  <f:facet name="header">Reindex</f:facet>
                  <h:selectBooleanCheckbox value="#{clazz.reindex}" />
                </rich:column>
                <rich:column width="auto" styleClass="centered">
                  <f:facet name="header">Optimize</f:facet>
                  <h:selectBooleanCheckbox value="#{clazz.optimize}" />
                </rich:column>
              </rich:dataTable>

              <a4j:commandButton id="reindex"
                  value="#{messages['jsf.ReindexFullTextSearchDatabase']}"
                  action="#{reindexAction.reindexDatabase}"
                  rendered="#{!reindexAction.reindexing}"
                  reRender="reindexPanel"/>

            </a4j:outputPanel>
          </a4j:region>
        </a4j:form>
      </rich:panel>
    </ui:define>
    
</ui:composition>
