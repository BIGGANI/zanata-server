<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    template="../WEB-INF/layout/template.xhtml"
    >
    
    <ui:define name="left_content">
      <s:fragment rendered="#{identity.loggedIn}">
        <rich:panel>
          <f:facet name="header">#{messages['jsf.Actions']}</f:facet>
          <s:link styleClass="action_link" view="/profile/edit.xhtml" propagation="none">
            #{messages['jsf.EditProfile']}
          </s:link>
          <s:link styleClass="action_link" view="/account/changepassword.xhtml" propagation="none" rendered="#{applicationConfiguration.internalAuth}">
            #{messages['jsf.ChangePassword']}
          </s:link>
        </rich:panel>
      </s:fragment>
    </ui:define>
    
    <ui:define name="center_content">
        <rich:jQuery selector="#tab_profile" query="addClass('ui-tabs-selected')" />
        <h1>#{personHome.instance.account.username}</h1>
        <br/>
        <h2>#{messages['jsf.MyProjects']}</h2>
        <h:outputText value="None Available" rendered="#{empty personHome.instance.maintainerProjects}"/>
         <h:form>
         <rich:dataTable columnsWidth="200px,200px,80px" 
            value="#{personHome.instance.maintainerProjects.toArray()}" var="project">
                <rich:column sortBy="#{project.slug}">
                     <f:facet name="header">Project Name</f:facet>
                           <s:link id="project" styleClass="table_link" value="#{project.name}"  propagation="none"
                             view="/project/project.xhtml"> 
                            <f:param name="slug" value="#{project.slug}"/>
                        </s:link>
                    </rich:column>
                <rich:column>
                        <f:facet name="header">Description</f:facet>
                        <h:outputText value="#{project.description}" />
                    </rich:column>
                <rich:column>
                        <f:facet name="header">Iterations</f:facet>
                        <ui:repeat value="#{project.projectIterations}" var="t">
                            <span style="margin-right: 1pt; margin-left: 1pt;">#{t.slug}</span>
                        </ui:repeat>                   
                    </rich:column>
        </rich:dataTable>
        </h:form>
        <br/>
        <h2>#{messages['jsf.MyLanguages']}</h2>
        <h:outputText value="None Available" rendered="#{empty personHome.instance.languageMemberships}"/>
        <h:form>
            <rich:dataTable value="#{personHome.instance.languageMemberships.toArray()}" var="language">
                <rich:column sortBy="#{language.localeId.id}">
                    <f:facet name="header">#{messages['jsf.Language']}</f:facet>
                    <s:link view="/language/language.xhtml" propagation="none" value="#{language.localeId.id}" styleClass="table_link">
                        <f:param name="id" value="#{language.localeId.id}" />
                    </s:link>
                </rich:column>
                <rich:column sortBy="#{language.retrieveDisplayName()}">
                    <f:facet name="header">#{messages['jsf.Name']}</f:facet>
                    #{language.retrieveDisplayName()}
                </rich:column>
                <rich:column >
                    <f:facet name="header">#{messages['jsf.NativeName']}</f:facet>
                    #{language.retrieveNativeName()}
                </rich:column>
                <rich:column sortBy="#{language.members.size}">
                    <f:facet name="header">#{messages['jsf.Members']}</f:facet>
                    #{language.members.size}
                </rich:column>
            </rich:dataTable>
        </h:form>
        <br/>
        <h2>#{messages['jsf.ApiKey']}</h2>
        <h:form>
          <s:token allowMultiplePosts="true" />
          <s:span id="no_api_key" rendered="#{personHome.instance.account.apiKey == null}">#{messages['jsf.NotGenerated']}</s:span>
          <s:fragment id="api_key" rendered="#{personHome.instance.account.apiKey != null}"> 
            <p>#{messages['jsf.YourCurrentApiKeyIs']}
              <code>#{personHome.instance.account.apiKey}</code> 
            </p>
          </s:fragment>
          <h:commandButton action="#{personHome.regenerateApiKey}"
              value="Regenerate API Key" reRender="api_key,no_api_key"
              onclick="if (!confirm('Are you sure you want to regenerate your API Key?')) return false" />
	    </h:form>
    </ui:define>
</ui:composition>
