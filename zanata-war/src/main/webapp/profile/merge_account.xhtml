<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:rich="http://richfaces.org/rich"
                xmlns:a4j="http://richfaces.org/a4j"
                xmlns:s="http://jboss.com/products/seam/taglib"
                template="../WEB-INF/layout/template.xhtml">

    <ui:define name="page_title">Merge Accounts</ui:define>

    <ui:define name="head">
        <!-- Load jQuery -->
        <rich:jQuery query="jquery"/>

        <script type="text/javascript">
            function adjustLoginInput(visible, label)
            {
                var fieldSelector = "[id='#{rich:clientId('input')}']";
                if( visible )
                {
                    jQuery("[id='#{rich:clientId('usernameLabel')}']").html( label );
                    jQuery(fieldSelector).show();
                }
                else
                {
                    jQuery(fieldSelector).hide();
                }
                jQuery("[id='#{rich:clientId('verifyButton')}']").show();
            }
        </script>
    </ui:define>

    <ui:define name="center_content">
        <h:form rendered="#{not accountMergeAction.accountSelected}">
            <h:outputText>
                Please log in to the account you want to merge. Be aware that said account will be disabled permanently
                and you will inherit all security related permissions on that account (i.e. User roles, language teams,
                maintained projects, etc.)
            </h:outputText>
            <br/>
            <br/>
            <rich:spacer height="10"/>
            <a4j:commandButton id="fedora_signin" image="../images/openid/fedora.png" action="#{fedoraOpenId.useFedoraProvider}"
                               styleClass="login_option" title="Fedora"
                               onclick="adjustLoginInput(true, '#{messages['jsf.login.openid.fedora']}')"/>
            <rich:spacer width="10"/>
            <h:commandButton id="google_signin" image="../images/openid/google.png" action="#{loginAction.useGoogleLogin}"
                             styleClass="login_option" title="Google"/>
            <rich:spacer width="10"/>
            <a4j:commandButton id="myopenid_signin" image="../images/openid/myopenid.png" action="#{fedoraOpenId.useMyOpenIdProvider}"
                               styleClass="login_option" title="MyOpenID"
                               onclick="adjustLoginInput(true, '#{messages['jsf.login.openid.myopenid']}')"/>
            <rich:spacer width="10"/>
            <a4j:commandButton id="yahoo_signin" image="../images/openid/yahoo.png" action="#{fedoraOpenId.useYahooOpenIdProvider}"
                               styleClass="login_option" title="Yahoo"
                               onclick="adjustLoginInput(true, '#{messages['jsf.login.openid.yahoo']}')"/>
            <rich:spacer width="10"/>
            <a4j:commandButton id="openid_signin" image="../images/openid/openid.png" action="#{fedoraOpenId.useGenericOpenIdProvider}"
                               styleClass="login_option" title="Open Id"
                               onclick="adjustLoginInput(true, '#{messages['jsf.login.openid']}')"/>
            <rich:spacer width="10"/>

            <a4j:outputPanel id="input" style="display: none;">
                <h:outputLabel id="usernameLabel" styleClass="loginForm_label name">#{messages['jsf.FedoraUsername']}</h:outputLabel>
                <h:inputText id="username" value="#{accountMergeAction.username}"/>
                <br/>
                <h:commandButton id="verifyButton"
                                 value="#{messages['jsf.identities.Verify']}"
                                 action="#{accountMergeAction.loginToMergingAccount}"
                                 style="#{applicationConfiguration.fedoraOpenIdAuth ? 'display:none' : ''}"/>
            </a4j:outputPanel>
        </h:form>

        <h:form rendered="#{accountMergeAction.accountSelected}">
            You are about to merge in the following account:
            <br/>
            <br/>
            Username: #{accountMergeAction.obsoleteAccount.username}
            <br/>
            Name: #{accountMergeAction.obsoleteAccount.person.name}
            <br/>
            Email: #{accountMergeAction.obsoleteAccount.person.email}
            <br/>
            Are you sure you want to do this? This change is permanent and cannot be taken back.
            <br/>
            <br/>
            <h:commandButton value="Do it!" action="#{accountMergeAction.mergeAccounts}"/>
            <h:commandButton value="Cancel" />
        </h:form>
    </ui:define>

</ui:composition>