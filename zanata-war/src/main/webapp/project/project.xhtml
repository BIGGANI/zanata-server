<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.com/products/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a4j="http://richfaces.org/a4j"
    template="../WEB-INF/layout/template.xhtml">

<ui:define name="page_title">#{projectHome.instance.name}</ui:define>
<ui:define name="head">
</ui:define>

<ui:define name="center_content">
    <s:decorate id="main_content">

    <s:div styleClass="content_box" rendered="#{not empty projectHome.instance.homeContent or not empty projectHome.instance.description}">
        <s:formattedText id="project-home-content" value="#{projectHome.instance.homeContent}"/>
        <s:formattedText value="#{projectHome.instance.description}" rendered="#{empty projectHome.instance.homeContent}"/>
    </s:div>

   	<div class="iterations">
        <rich:dataGrid id="activeIterations" columns="5"
                       value="#{projectHome.activeIterations}"
                       var="_iteration"
                       columnClasses="iteration_grid_col">
            <s:link view="/iteration/view.xhtml" styleClass="version_link">
                <f:param name="projectSlug" value="#{projectHome.instance.slug}"/>
                <f:param name="iterationSlug" value="#{_iteration.slug}"/>
                <div class="version_link_div">
                    <div class="version_title">
                        <h:outputText value="#{_iteration.slug}"/>
                    </div>
                    <div class="version_info">
                        Documents: #{_iteration.documents.size()}
                    </div>
                </div>
            </s:link>
        </rich:dataGrid>
        
        <rich:spacer height="10px" />
        
        <rich:dataGrid id="readOnlyIterations" columns="5"
                value="#{projectHome.readOnlyIterations}"
                var="_iteration"
                columnClasses="iteration_grid_col">
           <s:link view="/iteration/view.xhtml" styleClass="version_link">
               <f:param name="projectSlug" value="#{projectHome.instance.slug}"/>
               <f:param name="iterationSlug" value="#{_iteration.slug}"/>
               <div class="version_link_div">
                   <div class="version_title">
                       <h:outputText value="#{_iteration.slug}"/>
                   </div>
                   <span class="icon-lock-4" title="#{messages['jsf.ReadOnlyVersions']}"/>
                   <div class="version_info">
                       Documents: #{_iteration.documents.size()}
                   </div>
               </div>
           </s:link>
       </rich:dataGrid>
       
       <rich:spacer height="10px" />
       
       <rich:dataGrid id="obsoleteIterations" columns="5"
                value="#{projectHome.obsoleteIterations}"
                var="_iteration"
                columnClasses="iteration_grid_col">
           <s:link view="/iteration/view.xhtml" styleClass="version_link">
               <f:param name="projectSlug" value="#{projectHome.instance.slug}"/>
               <f:param name="iterationSlug" value="#{_iteration.slug}"/>
               <div class="version_link_div">
                   <div class="version_title">
                       <h:outputText value="#{_iteration.slug}"/>
                   </div>
                   
                   <span class="icon-block" title="#{messages['jsf.ObsoleteVersions']}"/>
                   <div class="version_info">
                       Documents: #{_iteration.documents.size()}
                   </div>
               </div>
           </s:link>
       </rich:dataGrid>
   	</div>
    </s:decorate>
</ui:define>

<ui:define name="right_content">

  <rich:panel id="loggedIn" rendered="#{identity.loggedIn}">
    <f:facet name="header">#{messages['jsf.Actions']}</f:facet>
    <s:link styleClass="action_link" rendered="#{s:hasPermission(projectHome.instance, 'update')}" value="#{messages['jsf.EditProject']}" view="/project/edit.xhtml" propagation="none">
      <f:param name="slug" value="#{projectHome.instance.slug}"/>
    </s:link>
    <s:link styleClass="action_link" rendered="#{s:hasRole('admin')}" value="#{messages['jsf.project.EditHomePage.label']}" view="/project/homepage_edit.xhtml" title="#{messages['jsf.project.EditHomePage.tooltip']}" propagation="none">
      <f:param name="slug" value="#{projectHome.instance.slug}"/>
    </s:link>
    <s:link styleClass="action_link" rendered="#{s:hasPermission(projectHome.instance, 'add-iteration') and projectHome.isProjectActive()}" view="/project/add_iteration.xhtml" value="#{messages['jsf.CreateVersion']}" propagation="none">
    	<f:param name="projectSlug" value="#{projectHome.instance.slug}"/>
    </s:link>
    <s:link styleClass="action_link" rendered="#{s:hasPermission(projectHome.instance, 'update')}" view="/project/assign_maintainer.xhtml" value="#{messages['jsf.ManageMaintainers']}" propagation="none">
    	<f:param name="projectSlug" value="#{projectHome.instance.slug}"/>
    </s:link>
    <s:link styleClass="action_link" rendered="#{s:hasPermission(projectHome.instance, 'update')}" view="/project/copy_trans_options.xhtml" value="#{messages['jsf.project.CopyTransOpts.linkTitle']}" title="#{messages['jsf.project.CopyTransOpts.tooltip']}" propagation="none">
        <f:param name="projectSlug" value="#{projectHome.instance.slug}"/>
    </s:link>

  </rich:panel>

  <rich:panel>
    <f:facet name="header">#{messages['jsf.ProjectMaintainers']}</f:facet>
    <h:outputText rendered="#{empty projectHome.instance.maintainers}">#{messages['jsf.NoMaintainersDefined']}</h:outputText>
    <rich:dataList value="#{projectHome.instance.maintainers.toArray()}" var="maintainer">
      <h:outputText value="#{maintainer.name}"/>
    </rich:dataList>
  </rich:panel>

  <rich:panel rendered="#{projectHome.instance.restrictedByRoles}">
    <f:facet name="header">#{messages['jsf.project.RoleRestrictions']}</f:facet>
    <h:outputText>#{messages['jsf.project.ProjectRestrictedToFollowingRoles']}</h:outputText><br/>
    <rich:dataList value="#{projectHome.instance.allowedRoles.toArray()}" var="role">
      <h:outputText value="#{role.name}"/>
    </rich:dataList>
  </rich:panel>

</ui:define>

</ui:composition>
