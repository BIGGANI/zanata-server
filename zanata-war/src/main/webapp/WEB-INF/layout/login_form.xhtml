<h:form id="login"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:s="http://jboss.com/products/seam/taglib"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:a4j="http://richfaces.org/a4j"
>
    <!-- Load jQuery -->
    <rich:jQuery query="jquery"/>

    <script type="text/javascript">
        function adjustLoginInput(visible, label)
        {
            var fieldSelector = "[id='#{rich:clientId('fedoraUsernameField')}']";
            if( visible )
            {
                jQuery('#identityLabel').html( label );
                jQuery('#' + fieldSelector).show();
            }
            else
            {
                jQuery('#' + fieldSelector).hide();
            }

            jQuery("[id='login:Sign_in']").show();
        }
    </script>

	<s:token allowMultiplePosts="true" />
    <rich:panel rendered="#{not identity.loggedIn}">
        <f:facet name="header" class="loginForm_header">#{messages['jsf.SignIn']}</f:facet>

        <s:decorate id="usernameField" template="edit.xhtml" rendered="#{!applicationConfiguration.fedoraOpenIdAuth}">
            <ui:define name="label"><span class="loginForm_label">#{messages['jsf.Username']}</span></ui:define>
            <h:inputText id="username"
                      value="#{credentials.username}" class="loginForm_input"/>
        </s:decorate>

        <a4j:outputPanel rendered="#{applicationConfiguration.fedoraOpenIdAuth}">
            <h:outputText styleClass="name">#{messages['jsf.login.openid.SelectProvider']}</h:outputText><br/>
            <rich:spacer height="10"/>
            <a4j:commandButton id="fedora_signin" image="../images/openid/fedora.png" action="#{loginAction.useFedoraLogin}"
                               styleClass="login_option" title="Fedora"
                               onclick="adjustLoginInput(true, '#{messages['jsf.login.openid.fedora']}')"/>
            <rich:spacer width="10"/>
            <h:commandButton id="google_signin" image="../images/openid/google.png" action="#{loginAction.useGoogleLogin}"
                               styleClass="login_option" title="Google"/>
            <rich:spacer width="10"/>
            <a4j:commandButton id="myopenid_signin" image="../images/openid/myopenid.png" action="#{loginAction.useGenericOpenIdLogin}"
                               styleClass="login_option" title="MyOpenID"
                               onclick="adjustLoginInput(true, '#{messages['jsf.login.openid.myopenid']}')"/>
            <rich:spacer width="10"/>
            <a4j:commandButton id="yahoo_signin" image="../images/openid/yahoo.png" action="#{loginAction.useYahooOpenIdLogin}"
                               styleClass="login_option" title="Yahoo"
                               onclick="adjustLoginInput(true, '#{messages['jsf.login.openid.yahoo']}')"/>
            <rich:spacer width="10"/>
            <a4j:commandButton id="openid_signin" image="../images/openid/openid.png" action="#{loginAction.useGenericOpenIdLogin}"
                               styleClass="login_option" title="Open Id"
                               onclick="adjustLoginInput(true, '#{messages['jsf.login.openid']}')"/>
            <rich:spacer width="10"/>

            <s:decorate id="fedoraUsernameField" template="edit.xhtml" style="display: none">
                <ui:define name="label">
                    <span id="identityLabel" class="loginForm_label">#{messages['jsf.FedoraUsername']}</span>
                </ui:define>
                <h:inputText id="username" value="#{loginAction.username}"/>
                <ui:remove><h:inputHidden id="password" value="#{credentials.password}"/></ui:remove>
                <br/>
            </s:decorate>
        </a4j:outputPanel>

        <s:decorate id="passwordField" template="edit.xhtml" rendered="#{!applicationConfiguration.fedoraOpenIdAuth}">
            <ui:define name="label"><span class="loginForm_label">#{messages['jsf.Password']}</span></ui:define>
            <h:inputSecret id="password"
                        value="#{credentials.password}" class="loginForm_input"/>
            <rich:spacer width="10px"/>
            <s:link view="/account/password_reset_request.xhtml"
            	rendered="#{applicationConfiguration.internalAuth}"
            	propagation="none">#{messages['jsf.ForgotYourPassword']}</s:link>
        </s:decorate>
        <s:decorate id="rememberMeField" template="edit.xhtml" rendered="#{!applicationConfiguration.fedoraOpenIdAuth}">
            <ui:define name="label">#{messages['jsf.RememberMe']}</ui:define>
            <h:selectBooleanCheckbox id="rememberMe"
                                  value="#{rememberMe.enabled}"/>
        </s:decorate>
        <div style="clear:both"/>
        <div class="actionButtons">
            <h:commandButton id="Sign_in" value="#{messages['jsf.SignIn']}" action="#{loginAction.login}"
                    style="#{applicationConfiguration.fedoraOpenIdAuth ? 'display:none' : ''}"/>
        </div>
    </rich:panel>


</h:form>
